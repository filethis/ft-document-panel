<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../ft-document-list/ft-document-list.html">
<link rel="import" href="../ft-document-grid/ft-document-grid.html">

<!--
`ft-document-panel`
A panel that displays a list of FileThis documents

@demo demo/index.html
-->

<dom-module id="ft-document-panel">

    <style include="iron-flex iron-flex-alignment"></style>

    <template>

        <div class="layout vertical">

            <!-- Button bar -->
            <div class="layout horizontal">

                <!-- List button -->
                <div class="layout vertical center">
                    <paper-icon-button
                            icon="view-headline"
                            title="View as List"
                            style="color:#777777"
                            on-click="_onViewAsListButtonClicked">
                    </paper-icon-button>
                    <div style="font-family:Arial; font-size:8pt">List</div>
                </div>

                <div style="width:5px;"></div>

                <!-- Grid button -->
                <div class="layout vertical center">
                    <paper-icon-button
                            icon="apps"
                            title="View as Grid"
                            style="color:#777777"
                            on-click="_onViewAsGridButtonClicked">
                    </paper-icon-button>
                    <div style="font-family:Arial; font-size:8pt">Grid</div>
                </div>

                <div style="width:5px;"></div>

                <!-- Preview button -->
                <div class="layout vertical center">
                    <paper-icon-button
                            icon="visibility"
                            title="Preview"
                            style="color:#777777"
                            on-click="_onPreviewButtonClicked">
                    </paper-icon-button>
                    <div style="font-family:Arial; font-size:8pt">Preview</div>
                </div>

                <div style="width:40px;"></div>

                <!-- Upload button -->
                <div class="layout vertical center">
                    <paper-icon-button
                            icon="file-upload"
                            title="Upload"
                            style="color:#777777"
                            on-click="_onUploadButtonClicked">
                    </paper-icon-button>
                    <div style="font-family:Arial; font-size:8pt">Upload</div>
                </div>


                <div style="width:12px;"></div>

                <!-- Download button -->
                <div class="layout vertical center">
                    <paper-icon-button
                            icon="file-download"
                            title="Download"
                            style="color:#777777"
                            disabled="[[!selectedDocument]]"
                            on-click="_onDownloadButtonClicked">
                    </paper-icon-button>
                    <div style="font-family:Arial; font-size:8pt">Download</div>
                </div>

                <div style="width:40px;"></div>

                <!-- Delete button -->
                <div class="layout vertical center">
                    <paper-icon-button
                            icon="delete"
                            title="Delete"
                            style="color:#777777"
                            disabled="[[!selectedDocument]]"
                            on-click="_onDeleteButtonClicked">
                    </paper-icon-button>
                    <div style="font-family:Arial; font-size:8pt">Delete</div>
                </div>

                <div class="flex"></div>
                <div style="width:25px;"></div>

                <!-- Details button -->
                <div class="layout vertical center">
                    <paper-icon-button
                            icon="info-outline"
                            title="Show Details"
                            style="color:#777777"
                            on-click="_onShowDetailsButtonClicked">
                    </paper-icon-button>
                    <div style="font-family:Arial; font-size:8pt">Details</div>
                </div>
            </div>

            <!-- Views -->
            <iron-pages id="views" style="width:100%; height:100%;" selected="{{_selectedViewIndex}}">

                <!-- List -->
                <ft-document-list id="list"
                                  style="overflow:hidden; overflow-y:scroll; border:1px solid #DDD;"
                                  documents="[[documents]]">
                </ft-document-list>
                <!--<ft-document-list id="list"-->
                                  <!--style="overflow:hidden; overflow-y:scroll; border:1px solid #DDD;"-->
                                  <!--documents="[[documents]]"-->
                                  <!--selectedDocument="{{selectedDocument}}"-->
                                  <!--hasSelectedDocument="{{hasSelectedDocument}}">-->

                <!-- Grid -->
                <ft-document-grid id="grid"
                                  style="overflow:hidden; overflow-y:scroll; border:1px solid #DDD;"
                                  documents="[[documents]]">
                </ft-document-grid>

                <!-- Preview -->
                <div class="layout vertical center" style="width:100%; height:100%">
                    <div style="height:100px;"></div>
                    <iron-label style="font-size:24pt">
                        Document preview is coming soon
                    </iron-label>
                    <div style="height:100px;"></div>
                </div>

            </iron-pages>

        </div>

    </template>

    <script>
        Polymer({

            is: 'ft-document-panel',

            /**
             * Fired when the "Download" button is clicked.
             *
             * @event download
             * @param {Object} document The selected document whose file the user wants to download.
             */

            /**
             * Fired when the "Upload" button is clicked.
             *
             * @event upload
             */

            /**
             * Fired when the "Delete" button is clicked.
             *
             * @event delete
             * @param {Object} document The selected document to be deleted.
             */

            /**
             * Fired when the "Show Details" button is clicked.
             *
             * @event show-details
             */

            properties: {

                /** The list of documents resources to be displayed. */
                documents:
                {
                    type: Array,
                    notify: true,
                    value: [],
                    observer: "_documentsChanged"
                },

                /** The currently-selected document, if any. */
                selectedDocument:
                {
                    type: Object,
                    notify: true,
                    value: null
                },

                _selectedViewIndex:
                {
                    type: Number,
                    notify: true,
                    value: "0"
                },

                /** The FileThis ticket. Used for uploads. */
                ticket:
                {
                    type: String,
                    notify: true,
                    value: ""
                }
            },

            // Man, this is fugly...

            _documentsChanged: function()
            {
                setInterval(this._fixGrid.bind(this), 1)
            },

            _fixGrid: function()
            {
                var currentSelectedViewIndex = this._selectedViewIndex;
                var tempSelectedViewIndex;
                if (currentSelectedViewIndex == 0)
                    tempSelectedViewIndex = 1;
                else
                    tempSelectedViewIndex = 0;
                this._selectedViewIndex = tempSelectedViewIndex;
                this._selectedViewIndex = currentSelectedViewIndex;
            },

            ready: function()
            {
                this.$.list.addEventListener("selected-document-changed", function(event) {
                    this.selectedDocument = this.$.list.selectedDocument;
                }.bind(this));
            },

            _onViewAsListButtonClicked: function(event)
            {
                this._selectedViewIndex = 0;
            },

            _onViewAsGridButtonClicked: function(event)
            {
                this._selectedViewIndex = 1;
            },

            _onPreviewButtonClicked: function(event)
            {
                this._selectedViewIndex = 2;
            },

            _onDownloadButtonClicked: function(event)
            {
                this.fire('download', this.selectedDocument);
            },

            _onUploadButtonClicked: function(event)
            {
                this.fire('upload');
            },

            _onDeleteButtonClicked: function(event)
            {
                this.fire('delete', this.selectedDocument);
            },

            _onShowDetailsButtonClicked: function(event)
            {
                this.fire('show-details');
            }

        });
    </script>
</dom-module>
